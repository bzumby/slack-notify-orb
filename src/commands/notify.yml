description: >
  Send slack message on event with custom template.
parameters:
  event:
    default: always
    type: enum
    enum:
        - fail
        - pass
        - always
    description: "Pass/Fail/Always event"
  slack_channel:
    type: string
    default: ""
    description: "Slack Channel ID"
  template:
    type: string
    default: ""
    description: "Template name from slack_tempates folder"
steps:
  - run:
      environment:
        basic_job_fail: "<<include(slack_templates/basic_job_fail.json)>>"
        basic_job_success: "<<include(slack_templates/basic_job_success.json)>>"
        basic_workflow_success: "<<include(slack_templates/basic_workflow_success.json)>>"
      command: |
        echo "export basic_workflow_success=$(echo $basic_workflow_success | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed 's/`/\\`/g')
        echo "export basic_job_success=$(echo $basic_job_success | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed 's/`/\\`/g')
        echo "export basic_job_fail=$(echo $basic_job_fail | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed 's/`/\\`/g')
        echo "export SLACK_MESSAGE_TEMPLATE_NAME=<< parameters.template >>" >> $BASH_ENV
  - slack/notify:
      event: << parameters.event >>
      channel: << parameters.slack_channel >>
      custom: $(echo ${!SLACK_MESSAGE_TEMPLATE_NAME})
